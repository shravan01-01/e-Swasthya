<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>e-Swasthya</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- FontAwesome CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
  <!-- React & ReactDOM CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    html { scroll-behavior: smooth; }
    body { font-family: 'Inter', 'Segoe UI', Arial, sans-serif; }
    .fade-in { animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .slide-up { animation: slideUp 0.7s cubic-bezier(.4,2,.3,1); }
    @keyframes slideUp { from { transform: translateY(40px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .pulse-bg {
      background: linear-gradient(135deg, #e0f7fa 0%, #b2d8f2 50%, #80deea 100%);
      animation: pulseBg 3s infinite alternate;
    }
    @keyframes pulseBg {
      0% { filter: brightness(1); }
      100% { filter: brightness(1.08) saturate(1.2); }
    }
    .animated-gradient {
      background: linear-gradient(270deg, #e0f7fa, #b2ebf2, #80deea, #f8fafc);
      background-size: 800% 800%;
      animation: gradientMove 8s ease-in-out infinite;
    }
    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    /* Global scrollbar styling */
    * {
      scrollbar-width: thin;           /* Firefox */
      scrollbar-color: #93c5fd #e5e7eb; /* thumb track */
    }
    *::-webkit-scrollbar { height: 10px; width: 10px; }
    *::-webkit-scrollbar-track { background: #e5e7eb; border-radius: 8px; }
    *::-webkit-scrollbar-thumb { background: #93c5fd; border-radius: 8px; }
    *::-webkit-scrollbar-thumb:hover { background: #60a5fa; }
    /* Responsive tweaks for mobile/tablet */
    @media (max-width: 1024px) {
      .max-w-2xl, .max-w-xl, .max-w-lg, .max-w-md, .w-80, .w-56 {
        max-width: 100vw !important;
        width: 100vw !important;
      }
      .p-12, .p-8, .p-6, .px-8, .px-6, .px-5 {
        padding: 1rem !important;
      }
      .m-4 {
        margin: 0 !important;
      }
      .rounded-xl, .rounded-2xl, .rounded-3xl, .rounded-l-full, .rounded-r-3xl {
        border-radius: 1rem !important;
      }
      .flex-row, .flex-col {
        flex-direction: column !important;
      }
      .gap-16, .gap-8, .gap-4, .gap-3, .gap-2 {
        gap: 1rem !important;
      }
      .h-full, .min-h-screen {
        min-height: 100vh !important;
        height: auto !important;
      }
      .overflow-y-auto {
        overflow-y: auto !important;
      }
    }
    @media (max-width: 600px) {
      html, body {
        font-size: 16px !important;
        background: #f8fafc !important;
      }
      .text-2xl, .text-3xl, .text-xl, .text-lg {
        font-size: 1.15rem !important;
      }
      .p-12, .p-8, .p-6, .px-8, .px-6, .px-5 {
        padding: 0.75rem !important;
      }
      .rounded-xl, .rounded-2xl, .rounded-3xl, .rounded-l-full, .rounded-r-3xl {
        border-radius: 0.5rem !important;
      }
      .shadow, .shadow-lg, .shadow-sm {
        box-shadow: none !important;
      }
      .w-80, .w-56, .max-w-2xl, .max-w-xl, .max-w-lg, .max-w-md {
        width: 100vw !important;
        max-width: 100vw !important;
      }
      .flex-row, .flex-col {
        flex-direction: column !important;
      }
      .gap-16, .gap-8, .gap-4, .gap-3, .gap-2 {
        gap: 0.5rem !important;
      }
      .h-full, .min-h-screen {
        min-height: 100vh !important;
        height: auto !important;
      }
      .overflow-y-auto {
        overflow-y: auto !important;
      }
      img, video {
        max-width: 100% !important;
        height: auto !important;
      }
      table {
        font-size: 1rem !important;
        width: 100% !important;
        display: block !important;
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch !important;
      }
      th, td {
        padding: 0.6rem !important;
      }
      input, button, select, textarea {
        font-size: 1rem !important;
        min-height: 44px !important;
        min-width: 44px !important;
        border-radius: 0.5rem !important;
      }
      .fixed, .absolute {
        position: static !important;
      }
      .modal, .slide-up, .fade-in {
        max-width: 100vw !important;
        width: 100vw !important;
        left: 0 !important;
        right: 0 !important;
        top: 0 !important;
        bottom: 0 !important;
        margin: 0 !important;
      }
      .sidebar, nav, aside {
        display: none !important;
      }
      .dashboard-main, main, section {
        padding: 0.5rem !important;
      }
      .profile-modal, .profile-sidebar {
        max-width: 100vw !important;
        width: 100vw !important;
        left: 0 !important;
        right: 0 !important;
        top: 0 !important;
        bottom: 0 !important;
        margin: 0 !important;
      }
      .max-w-md, .max-w-lg, .max-w-xl, .max-w-2xl {
        max-width: 100vw !important;
      }
      .z-10, .z-20, .z-30 {
        z-index: 10 !important;
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-teal-50 min-h-screen">
  <div id="root"></div>
  <script src="./state_city_map.js"></script>
  <script type="text/babel">

// Dummy Data
const LOCATIONS = [
  "Thiruvananthapuram", "Kollam", "Pathanamthitta", "Alappuzha", "Kottayam", "Idukki", "Ernakulam", "Thrissur", "Palakkad", "Malappuram", "Kozhikode", "Wayanad", "Kannur", "Kasaragod", "Kochi", "Trivandrum", "Kozhikode", "Thrissur", "Kannur"
];
const DUMMY_PATIENTS = [
  { id: 1, name: "Rahul Kumar", age: 28, lastVisit: "2025-09-01" },
  { id: 2, name: "Amit Singh", age: 34, lastVisit: "2025-08-21" },
];
const DUMMY_REPORTS = [
  { id: 1, patient: "Rahul Kumar", type: "Blood Test", date: "2025-09-01" },
  { id: 2, patient: "Amit Singh", type: "X-Ray", date: "2025-08-21" },
];
const DUMMY_APPOINTMENTS = [
  { id: 1, with: "Dr. Meera", date: "2025-09-10", status: "Upcoming" },
  { id: 2, with: "Dr. John", date: "2025-08-15", status: "Completed" },
];

// Simple demo appointments for patient view
const DUMMY_PATIENT_APPOINTMENTS = [
  { id: 1, doctor: "Dr. Meera", date: "2025-10-12", time: "10:30 AM", status: "Upcoming", reason: "Routine Checkup" },
  { id: 2, doctor: "Dr. John", date: "2025-09-20", time: "02:00 PM", status: "Completed", reason: "Follow-up" },
  { id: 3, doctor: "Dr. Anil", date: "2025-09-05", time: "11:15 AM", status: "Cancelled", reason: "Fever" },
];

// Demo prescriptions
const DUMMY_PRESCRIPTIONS = [
  {
    id: 1,
    patient: "Rahul Kumar",
    doctor: "Dr. Meera",
    date: "2025-09-02",
    medicines: [
      { name: "Paracetamol 500mg", dosage: "1 tab", freq: "TID", days: 3 },
      { name: "Cetrizine 10mg", dosage: "1 tab", freq: "HS", days: 5 },
    ],
    notes: "Drink plenty of fluids and rest."
  },
  {
    id: 2,
    patient: "Amit Singh",
    doctor: "Dr. John",
    date: "2025-08-22",
    medicines: [
      { name: "Pantoprazole 40mg", dosage: "1 tab", freq: "OD", days: 7 },
    ],
    notes: "Take before breakfast. Avoid spicy food."
  },
  {
    id: 3,
    patient: "Rahul Kumar",
    doctor: "Dr. John",
    date: "2025-07-15",
    medicines: [
      { name: "Amoxicillin 500mg", dosage: "1 cap", freq: "TID", days: 5 },
      { name: "Ibuprofen 200mg", dosage: "1 tab", freq: "TID", days: 3 },
    ],
    notes: "Complete full antibiotic course."
  },
  {
    id: 4,
    patient: "Priya Sharma",
    doctor: "Doctor",
    date: "2025-09-18",
    medicines: [
      { name: "Azithromycin 500mg", dosage: "1 tab", freq: "OD", days: 3 },
      { name: "Vitamin C 500mg", dosage: "1 tab", freq: "OD", days: 7 },
    ],
    notes: "Take after meals."
  },
  {
    id: 5,
    patient: "Sunita Devi",
    doctor: "Doctor",
    date: "2025-09-05",
    medicines: [
      { name: "Metformin 500mg", dosage: "1 tab", freq: "BD", days: 30 },
      { name: "Atorvastatin 10mg", dosage: "1 tab", freq: "HS", days: 30 },
    ],
    notes: "Monitor fasting glucose weekly."
  }
];

const DUMMY_PATIENT_REQUESTS = [
  { id: 1, patientName: "Rahul Kumar", patientAge: 28, date: "2025-09-12", time: "10:00 AM", reason: "Routine Checkup", status: "Pending" },
  { id: 2, patientName: "Priya Sharma", patientAge: 32, date: "2025-09-12", time: "11:30 AM", reason: "Fever & Cold", status: "Pending" },
  { id: 3, patientName: "Amit Singh", patientAge: 34, date: "2025-09-13", time: "09:00 AM", reason: "Follow-up Visit", status: "Pending" },
  { id: 4, patientName: "Sunita Devi", patientAge: 45, date: "2025-09-13", time: "02:00 PM", reason: "Blood Pressure Check", status: "Approved" },
];

// Context for global state
const AppContext = React.createContext();

function AppProvider({children}) {
  const [user, setUser] = React.useState(null); // {aadhar, location}
  const [role, setRole] = React.useState(null); // "doctor" | "patient"
  const [profileOpen, setProfileOpen] = React.useState(false);
  return (
    <AppContext.Provider value={{
      user, setUser, role, setRole, profileOpen, setProfileOpen
    }}>
      {children}
    </AppContext.Provider>
  );
}

// Routing (simple SPA)
function useRoute() {
  const [route, setRoute] = React.useState(window.location.hash.slice(1) || "/");
  React.useEffect(() => {
    const onHash = () => setRoute(window.location.hash.slice(1) || "/");
    window.addEventListener("hashchange", onHash);
    return () => window.removeEventListener("hashchange", onHash);
  }, []);
  const navigate = (to) => { window.location.hash = to; };
  return [route, navigate];
}

// Main App
function App() {
  const [route, navigate] = useRoute();
  const { user, role, setUser } = React.useContext(AppContext);
  const [loginMode, setLoginMode] = React.useState("login"); // "login" or "register"
  const [preLogin, setPreLogin] = React.useState(true);
  const [tempLogin, setTempLogin] = React.useState({ phone: "", email: "" });
  const [regAadhar, setRegAadhar] = React.useState("");
  const [regState, setRegState] = React.useState("");
  const [regLocation, setRegLocation] = React.useState("");
  const [regInfo, setRegInfo] = React.useState({ name: "", age: "", gender: "", dob: "", blood: "", height: "", weight: "" });
  const [regStep, setRegStep] = React.useState(0); // 0: login, 1: aadhar, 2: info

  React.useEffect(() => {
    // Redirect logic
    if (!user && route !== "/") navigate("/");
    if (user && !role && route !== "/role") navigate("/role");
    if (user && role && !route.startsWith("/dashboard")) navigate(`/dashboard/${role}`);
  }, [user, role, route]);

  // Registration flow
  function handleRegisterStart(phone, email) {
    setTempLogin({ phone, email });
    setLoginMode("register");
    setRegStep(1);
  }
  function handleAadharContinue(aadhar, state, location) {
    setRegAadhar(aadhar);
    setRegState(state);
    setRegLocation(location);
    setRegStep(2);
  }
  function handleUserInfoContinue(info) {
    // Save user info in context
    setUser({
      ...tempLogin,
      aadhar: regAadhar,
      state: regState,
      location: regLocation,
      ...info
    });
    setLoginMode("login");
    setRegStep(0);
    navigate("/role");
  }
  function handleBackToLogin() {
    setLoginMode("login");
    setRegStep(0);
  }

  // Login flow
  function handleLoginContinue(phone, email) {
    // Check if user is registered (simulate with localStorage)
    const regUser = JSON.parse(localStorage.getItem("eSwasthyaUser_"+phone) || "null");
    if (regUser) {
      setUser(regUser);
      navigate("/role");
    } else {
      // Allow login without registration: create minimal user object
      setUser({ phone, email });
      navigate("/role");
    }
  }

  // Save user to localStorage on registration
  React.useEffect(() => {
    if (user && user.phone) {
      localStorage.setItem("eSwasthyaUser_"+user.phone, JSON.stringify(user));
    }
  }, [user]);

  return (
    <div className="min-h-screen flex flex-col overflow-hidden">
      <Header />
      <main className="flex-1 flex items-center justify-center fade-in overflow-y-auto">
        {route === "/" && loginMode === "login" && preLogin && (
          <NewLoginScreen
            onContinue={(phone, email) => handleLoginContinue(phone, email)}
            onRegister={(phone, email) => handleRegisterStart(phone, email)}
          />
        )}
        {route === "/" && loginMode === "register" && regStep === 1 && (
          <AadharPage
            onContinue={handleAadharContinue}
            onBack={handleBackToLogin}
          />
        )}
        {route === "/" && loginMode === "register" && regStep === 2 && (
          <UserInfoPage
            onContinue={handleUserInfoContinue}
            onBack={() => setRegStep(1)}
          />
        )}
  {route === "/role" && <RoleSelection />}
        {route.startsWith("/dashboard/doctor") && <DoctorDashboard />}
        {route.startsWith("/dashboard/patient") && <PatientDashboard />}
      </main>
      <Footer />
    </div>
  );
}
// New Login Page (before main login)
function NewLoginScreen({ onContinue, onRegister }) {
  const [phone, setPhone] = React.useState("");
  const [email, setEmail] = React.useState("");
  const [otp, setOtp] = React.useState("");
  const [otpSent, setOtpSent] = React.useState(false);
  const [error, setError] = React.useState("");

  function handleSendOtp(e) {
    e.preventDefault();
    if (!/^\d{10}$/.test(phone)) {
      setError("Enter valid 10-digit phone number");
      return;
    }
    if (!/^\S+@\S+\.\S+$/.test(email)) {
      setError("Enter valid email address");
      return;
    }
    setError("");
    setOtpSent(true);
  }

  function handleContinue(e) {
    e.preventDefault();
    if (!otpSent) {
      setError("Please request OTP first");
      return;
    }
    if (!/^\d{4,6}$/.test(otp)) {
      setError("Enter valid OTP");
      return;
    }
    setError("");
    onContinue(phone, email);
  }

  function handleRegister(e) {
    e.preventDefault();
    if (!/^\d{10}$/.test(phone)) {
      setError("Enter valid 10-digit phone number");
      return;
    }
    if (!/^\S+@\S+\.\S+$/.test(email)) {
      setError("Enter valid email address");
      return;
    }
    setError("");
    onRegister(phone, email);
  }

  return (
    <div className="fixed inset-0 flex items-center justify-center z-20 fade-in animated-gradient">
      <div className="w-full h-full flex items-center justify-center">
        <div className="w-full max-w-md bg-white/90 rounded-xl shadow-lg p-8 slide-up">
          <h2 className="text-2xl font-bold text-blue-900 mb-6 text-center">Login to e-Swasthya</h2>
          <form className="space-y-5" onSubmit={handleContinue}>
            <div>
              <label className="block text-blue-800 mb-1 font-medium">Phone Number</label>
              <input
                type="tel"
                maxLength={10}
                pattern="\d{10}"
                value={phone}
                onChange={e => setPhone(e.target.value.replace(/\D/g, ""))}
                className="w-full border border-blue-200 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-300"
                placeholder="Enter 10-digit phone"
                required
              />
            </div>
            <div>
              <label className="block text-blue-800 mb-1 font-medium">Email ID</label>
              <input
                type="email"
                value={email}
                onChange={e => setEmail(e.target.value)}
                className="w-full border border-blue-200 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-300"
                placeholder="Enter your email"
                required
              />
            </div>
            <div className="flex gap-2 items-end">
              <div className="flex-1">
                <label className="block text-blue-800 mb-1 font-medium">OTP</label>
                <input
                  type="text"
                  maxLength={6}
                  pattern="\d{4,6}"
                  value={otp}
                  onChange={e => setOtp(e.target.value.replace(/\D/g, ""))}
                  className="w-full border border-blue-200 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-300"
                  placeholder="Enter OTP"
                  required
                  disabled={!otpSent}
                />
              </div>
              <button
                type="button"
                className="bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded transition"
                onClick={handleSendOtp}
                disabled={otpSent}
              >
                {otpSent ? "OTP Sent" : "Send OTP"}
              </button>
            </div>
            {error && <div className="text-red-600 text-sm">{error}</div>}
            <button
              type="submit"
              className="w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 rounded transition"
            >
              Login
            </button>
            <button
              type="button"
              className="w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-2 rounded transition"
              onClick={handleRegister}
            >
              Register
            </button>
          </form>
        </div>
      </div>
    </div>
  );
}

// Registration Aadhar/location page
function AadharPage({ onContinue, onBack }) {
  const [aadhar, setAadhar] = React.useState("");
  const [state, setState] = React.useState("");
  const [location, setLocation] = React.useState("");
  const [showLoc, setShowLoc] = React.useState(false);
  const [showState, setShowState] = React.useState(false);
  const [error, setError] = React.useState("");
  const STATES = Object.keys(window.STATE_CITY_MAP || {});
  const cities = state ? (window.STATE_CITY_MAP[state] || []) : [];

  function handleContinue(e) {
    e.preventDefault();
    if (!/^\d{12}$/.test(aadhar)) {
      setError("Enter valid 12-digit Aadhar number");
      return;
    }
    if (!state) {
      setError("Please select your state");
      return;
    }
    if (!location) {
      setError("Please select your city");
      return;
    }
    setError("");
    onContinue(aadhar, state, location);
  }

  return (
    <div className="fixed inset-0 flex items-center justify-center z-10 fade-in animated-gradient">
      <div className="w-full h-full flex items-center justify-center">
        <div className="w-full max-w-md bg-white/90 rounded-xl shadow-lg p-8 slide-up">
          <h2 className="text-2xl font-bold text-blue-900 mb-6 text-center">Aadhar & Location</h2>
          <form onSubmit={handleContinue} className="space-y-5">
            <div>
              <label className="block text-blue-800 mb-1 font-medium">Aadhar Number</label>
              <input
                type="text"
                maxLength={12}
                pattern="\d{12}"
                value={aadhar}
                onChange={e => setAadhar(e.target.value.replace(/\D/g, ""))}
                className="w-full border border-blue-200 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-300"
                placeholder="Enter 12-digit Aadhar"
                required
              />
            </div>
            <div>
              <label className="block text-blue-800 mb-1 font-medium">State</label>
              <button
                type="button"
                className="w-full border border-blue-200 rounded px-3 py-2 text-left bg-white hover:bg-blue-50"
                onClick={() => setShowState(true)}
              >
                {state || "Select State"}
                <i className="fa-solid fa-chevron-down float-right mt-1"></i>
              </button>
            </div>
            <div>
              <label className="block text-blue-800 mb-1 font-medium">City</label>
              <button
                type="button"
                className="w-full border border-blue-200 rounded px-3 py-2 text-left bg-white hover:bg-blue-50"
                onClick={() => state && setShowLoc(true)}
                disabled={!state}
              >
                {location || "Select City"}
                <i className="fa-solid fa-chevron-down float-right mt-1"></i>
              </button>
            </div>
            {error && <div className="text-red-600 text-sm">{error}</div>}
            <button
              type="submit"
              className="w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 rounded transition"
            >
              Continue
            </button>
            <button
              type="button"
              className="w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-2 rounded transition"
              onClick={onBack}
            >
              Back
            </button>
          </form>
          {showState && (
            <div className="fixed inset-0 bg-black/30 flex items-center justify-center z-30">
              <div className="bg-white rounded-lg shadow-lg p-6 w-80 max-h-[80vh] overflow-y-auto">
                <h3 className="text-lg font-bold mb-4 text-blue-900">Select State</h3>
                <ul>
                  {STATES.map(s => (
                    <li key={s}>
                      <button
                        className="w-full text-left px-3 py-2 rounded hover:bg-blue-100"
                        onClick={() => { setState(s); setLocation(""); setShowState(false); }}
                      >
                        {s}
                      </button>
                    </li>
                  ))}
                </ul>
                <button
                  className="mt-4 text-sm text-blue-700 hover:underline"
                  onClick={() => setShowState(false)}
                >Cancel</button>
              </div>
            </div>
          )}
          {showLoc && (
            <div className="fixed inset-0 bg-black/30 flex items-center justify-center z-20">
              <div className="bg-white rounded-lg shadow-lg p-6 w-80 max-h-[80vh] overflow-y-auto">
                <h3 className="text-lg font-bold mb-4 text-blue-900">Select City</h3>
                <ul>
                  {cities.map(city => (
                    <li key={city}>
                      <button
                        className="w-full text-left px-3 py-2 rounded hover:bg-blue-100"
                        onClick={() => { setLocation(city); setShowLoc(false); }}
                      >
                        {city}
                      </button>
                    </li>
                  ))}
                </ul>
                <button
                  className="mt-4 text-sm text-blue-700 hover:underline"
                  onClick={() => setShowLoc(false)}
                >Cancel</button>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

// Registration User Info page
function UserInfoPage({ onContinue, onBack }) {
  const [form, setForm] = React.useState({ name: '', age: '', gender: '', dob: '', blood: '', height: '', weight: '' });
  const [error, setError] = React.useState("");
  function handleChange(e) {
    setForm(f => ({ ...f, [e.target.name]: e.target.value }));
  }
  function handleSubmit(e) {
    e.preventDefault();
    if (!form.name || !form.age || !form.gender || !form.dob || !form.blood || !form.height || !form.weight) {
      setError("Please fill all fields");
      return;
    }
    setError("");
    onContinue(form);
  }
  return (
    <div className="fixed inset-0 flex items-center justify-center z-10 fade-in animated-gradient">
      <div className="w-full h-full flex items-center justify-center">
        <div className="w-full max-w-md bg-white/90 rounded-xl shadow-lg p-8 slide-up">
          <h2 className="text-2xl font-bold text-blue-900 mb-6 text-center">User Information</h2>
          <form className="space-y-5" onSubmit={handleSubmit}>
            <div>
              <label className="block text-blue-800 mb-1 font-medium">Full Name</label>
              <input name="name" value={form.name} onChange={handleChange} className="w-full border border-blue-200 rounded px-3 py-2" required />
            </div>
            <div className="flex gap-4">
              <div className="flex-1">
                <label className="block text-blue-800 mb-1 font-medium">Age</label>
                <input name="age" type="number" min="0" value={form.age} onChange={handleChange} className="w-full border border-blue-200 rounded px-3 py-2" required />
              </div>
              <div className="flex-1">
                <label className="block text-blue-800 mb-1 font-medium">Gender</label>
                <select name="gender" value={form.gender} onChange={handleChange} className="w-full border border-blue-200 rounded px-3 py-2" required>
                  <option value="">Select</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Other">Other</option>
                </select>
              </div>
            </div>
            <div className="flex gap-4">
              <div className="flex-1">
                <label className="block text-blue-800 mb-1 font-medium">Date of Birth</label>
                <input name="dob" type="date" value={form.dob} onChange={handleChange} className="w-full border border-blue-200 rounded px-3 py-2" required />
              </div>
              <div className="flex-1">
                <label className="block text-blue-800 mb-1 font-medium">Blood Group</label>
                <select name="blood" value={form.blood} onChange={handleChange} className="w-full border border-blue-200 rounded px-3 py-2" required>
                  <option value="">Select</option>
                  <option value="A+">A+</option>
                  <option value="A-">A-</option>
                  <option value="B+">B+</option>
                  <option value="B-">B-</option>
                  <option value="O+">O+</option>
                  <option value="O-">O-</option>
                  <option value="AB+">AB+</option>
                  <option value="AB-">AB-</option>
                </select>
              </div>
            </div>
            <div className="flex gap-4">
              <div className="flex-1">
                <label className="block text-blue-800 mb-1 font-medium">Height (cm)</label>
                <input name="height" type="number" min="0" value={form.height} onChange={handleChange} className="w-full border border-blue-200 rounded px-3 py-2" required />
              </div>
              <div className="flex-1">
                <label className="block text-blue-800 mb-1 font-medium">Weight (kg)</label>
                <input name="weight" type="number" min="0" value={form.weight} onChange={handleChange} className="w-full border border-blue-200 rounded px-3 py-2" required />
              </div>
            </div>
            {error && <div className="text-red-600 text-sm">{error}</div>}
            <button type="submit" className="w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 rounded transition">Continue</button>
            <button type="button" className="w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-2 rounded transition" onClick={onBack}>Back</button>
          </form>
        </div>
      </div>
    </div>
  );
}

// Header
function Header() {
  const { user, role, setProfileOpen } = React.useContext(AppContext);
  return (
    <header className="w-full flex items-center justify-between px-6 py-4 bg-white/80 shadow-sm">
      <div className="flex items-center gap-2">
        <i className="fa-solid fa-heart-pulse text-teal-600 text-2xl"></i>
        <span className="font-bold text-xl text-blue-900 tracking-wide">e-Swasthya</span>
      </div>
      {user && role &&
        <button
          className="rounded-full bg-blue-100 hover:bg-teal-100 p-2 transition"
          onClick={() => setProfileOpen(true)}
          aria-label="Profile"
        >
          <i className="fa-solid fa-user text-blue-700 text-lg"></i>
        </button>
      }
      <ProfileModal />
    </header>
  );
}

// Footer
function Footer() {
  return (
    <footer className="w-full text-center py-3 text-xs text-blue-900/60">
      &copy; 2025 e-Swasthya. For Migrant Workers in Kerala.
    </footer>
  );
}

// Login Screen
function LoginScreen() {
  const { setUser } = React.useContext(AppContext);
  const [aadhar, setAadhar] = React.useState("");
  const [state, setState] = React.useState("");
  const [location, setLocation] = React.useState("");
  const [showLoc, setShowLoc] = React.useState(false);
  const [showState, setShowState] = React.useState(false);
  const [error, setError] = React.useState("");
  const navigate = useRoute()[1];

  function handleContinue(e) {
    e.preventDefault();
    if (!/^\d{12}$/.test(aadhar)) {
      setError("Enter valid 12-digit Aadhar number");
      return;
    }
    if (!state) {
      setError("Please select your state");
      return;
    }
    if (!location) {
      setError("Please select your city");
      return;
    }
    setUser({ aadhar, state, location });
    navigate("/role");
  }

  const STATES = Object.keys(window.STATE_CITY_MAP || {});
  const cities = state ? (window.STATE_CITY_MAP[state] || []) : [];

  return (
  <div className="fixed inset-0 flex items-center justify-center z-10 fade-in animated-gradient">
      <div className="w-full h-full flex items-center justify-center">
        <div className="w-full h-full flex flex-col items-center justify-center">
          <div className="w-full max-w-md bg-white/90 rounded-xl shadow-lg p-8 slide-up">
            <h2 className="text-2xl font-bold text-blue-900 mb-6 text-center">Welcome to e-Swasthya</h2>
            <form onSubmit={handleContinue} className="space-y-5">
              <div>
                <label className="block text-blue-800 mb-1 font-medium">Aadhar Number</label>
                <input
                  type="text"
                  maxLength={12}
                  pattern="\d{12}"
                  value={aadhar}
                  onChange={e => setAadhar(e.target.value.replace(/\D/g, ""))}
                  className="w-full border border-blue-200 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-300"
                  placeholder="Enter 12-digit Aadhar"
                  required
                />
              </div>
              <div>
                <label className="block text-blue-800 mb-1 font-medium">State</label>
                <button
                  type="button"
                  className="w-full border border-blue-200 rounded px-3 py-2 text-left bg-white hover:bg-blue-50"
                  onClick={() => setShowState(true)}
                >
                  {state || "Select State"}
                  <i className="fa-solid fa-chevron-down float-right mt-1"></i>
                </button>
              </div>
              <div>
                <label className="block text-blue-800 mb-1 font-medium">City</label>
                <button
                  type="button"
                  className="w-full border border-blue-200 rounded px-3 py-2 text-left bg-white hover:bg-blue-50"
                  onClick={() => state && setShowLoc(true)}
                  disabled={!state}
                >
                  {location || "Select City"}
                  <i className="fa-solid fa-chevron-down float-right mt-1"></i>
                </button>
              </div>
              {error && <div className="text-red-600 text-sm">{error}</div>}
              <button
                type="submit"
                className="w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 rounded transition"
              >
                Continue
              </button>
            </form>
            {showState && (
              <div className="fixed inset-0 bg-black/30 flex items-center justify-center z-30">
                <div className="bg-white rounded-lg shadow-lg p-6 w-80 max-h-[80vh] overflow-y-auto">
                  <h3 className="text-lg font-bold mb-4 text-blue-900">Select State</h3>
                  <ul>
                    {STATES.map(s => (
                      <li key={s}>
                        <button
                          className="w-full text-left px-3 py-2 rounded hover:bg-blue-100"
                          onClick={() => { setState(s); setLocation(""); setShowState(false); }}
                        >
                          {s}
                        </button>
                      </li>
                    ))}
                  </ul>
                  <button
                    className="mt-4 text-sm text-blue-700 hover:underline"
                    onClick={() => setShowState(false)}
                  >Cancel</button>
                </div>
              </div>
            )}
            {showLoc && (
              <div className="fixed inset-0 bg-black/30 flex items-center justify-center z-20">
                <div className="bg-white rounded-lg shadow-lg p-6 w-80 max-h-[80vh] overflow-y-auto">
                  <h3 className="text-lg font-bold mb-4 text-blue-900">Select City</h3>
                  <ul>
                    {cities.map(city => (
                      <li key={city}>
                        <button
                          className="w-full text-left px-3 py-2 rounded hover:bg-blue-100"
                          onClick={() => { setLocation(city); setShowLoc(false); }}
                        >
                          {city}
                        </button>
                      </li>
                    ))}
                  </ul>
                  <button
                    className="mt-4 text-sm text-blue-700 hover:underline"
                    onClick={() => setShowLoc(false)}
                  >Cancel</button>
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}

// Role Selection
function RoleSelection() {
  const { setRole, setUser } = React.useContext(AppContext);
  const navigate = useRoute()[1];
  const [showDoctorVerification, setShowDoctorVerification] = React.useState(false);
  
  function selectRole(r) {
    if (r === "doctor") {
      setShowDoctorVerification(true);
    } else {
      setRole(r);
      navigate(`/dashboard/${r}`);
    }
  }
  
  function handleDoctorVerification(doctorId, licenseNumber) {
    // Simple validation - in real app, this would check against a database
    const validDoctors = {
      "DOC001": "LIC123456",
      "DOC002": "LIC789012", 
      "DOC003": "LIC345678"
    };
    
    if (validDoctors[doctorId] === licenseNumber) {
      setRole("doctor");
      setShowDoctorVerification(false);
      navigate("/dashboard/doctor");
    } else {
      alert("Invalid Doctor ID or License Number. Please contact administration.");
    }
  }
  return (
    <div className="fixed inset-0 flex items-center justify-center z-10 fade-in animated-gradient">
      <div className="w-full h-full flex items-center justify-center">
        <div className="w-full h-full flex flex-col items-center justify-center">
          <div className="w-full max-w-2xl bg-white/90 rounded-xl shadow-lg p-12 flex flex-col items-center slide-up">
            <h2 className="text-3xl font-bold text-blue-900 mb-10 text-center">Select Your Role</h2>
            <div className="flex gap-16 w-full justify-center">
              <button
                className="flex flex-col items-center bg-blue-100 hover:bg-teal-200 rounded-2xl p-12 shadow transition transform hover:scale-105 focus:outline-none border-4 border-transparent hover:border-teal-400"
                onClick={() => selectRole("doctor")}
              >
                <i className="fa-solid fa-user-doctor text-7xl text-teal-700 mb-5 animate-bounce"></i>
                <span className="font-semibold text-2xl text-blue-900">Doctor</span>
              </button>
              <button
                className="flex flex-col items-center bg-blue-100 hover:bg-teal-200 rounded-2xl p-12 shadow transition transform hover:scale-105 focus:outline-none border-4 border-transparent hover:border-teal-400"
                onClick={() => selectRole("patient")}
              >
                <i className="fa-solid fa-user text-7xl text-teal-700 mb-5 animate-bounce"></i>
                <span className="font-semibold text-2xl text-blue-900">Patient</span>
              </button>
            </div>
          </div>
        </div>
      </div>
      {showDoctorVerification && (
        <DoctorVerificationModal 
          onVerify={handleDoctorVerification}
          onCancel={() => setShowDoctorVerification(false)}
        />
      )}
    </div>
  );
}

// Doctor Verification Modal
function DoctorVerificationModal({ onVerify, onCancel }) {
  const [doctorId, setDoctorId] = React.useState("");
  const [licenseNumber, setLicenseNumber] = React.useState("");
  const [error, setError] = React.useState("");

  function handleSubmit(e) {
    e.preventDefault();
    if (!doctorId.trim()) {
      setError("Please enter Doctor ID");
      return;
    }
    if (!licenseNumber.trim()) {
      setError("Please enter License Number");
      return;
    }
    setError("");
    onVerify(doctorId.trim(), licenseNumber.trim());
  }

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-30 fade-in">
      <div className="bg-white rounded-xl shadow-lg p-8 w-96 max-w-[90vw] slide-up">
        <div className="flex items-center justify-between mb-6">
          <h3 className="text-2xl font-bold text-blue-900">Doctor Verification</h3>
          <button
            className="text-blue-700 hover:text-red-500 text-xl"
            onClick={onCancel}
          >
            <i className="fa-solid fa-xmark"></i>
          </button>
        </div>
        
        <div className="mb-4 p-4 bg-blue-50 rounded-lg">
          <div className="flex items-center gap-2 text-blue-800 text-sm">
            <i className="fa-solid fa-shield-check text-blue-600"></i>
            <span>Please verify your medical credentials to access doctor features</span>
          </div>
        </div>

        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-blue-800 mb-1 font-medium">Doctor ID</label>
            <input
              type="text"
              value={doctorId}
              onChange={e => setDoctorId(e.target.value.toUpperCase())}
              className="w-full border border-blue-200 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-300"
              placeholder="Enter your Doctor ID (e.g., DOC001)"
              required
            />
          </div>
          
          <div>
            <label className="block text-blue-800 mb-1 font-medium">Medical License Number</label>
            <input
              type="text"
              value={licenseNumber}
              onChange={e => setLicenseNumber(e.target.value.toUpperCase())}
              className="w-full border border-blue-200 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-300"
              placeholder="Enter your License Number"
              required
            />
          </div>

          {error && <div className="text-red-600 text-sm">{error}</div>}
          
          <div className="flex gap-3 pt-2">
            <button
              type="submit"
              className="flex-1 bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 rounded transition"
            >
              <i className="fa-solid fa-check mr-2"></i>Verify
            </button>
            <button
              type="button"
              className="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 rounded transition"
              onClick={onCancel}
            >
              <i className="fa-solid fa-times mr-2"></i>Cancel
            </button>
          </div>
        </form>

        <div className="mt-4 p-3 bg-yellow-50 rounded-lg">
          <div className="text-yellow-800 text-xs">
            <i className="fa-solid fa-info-circle mr-1"></i>
            <strong>Demo Credentials:</strong><br/>
            Doctor ID: DOC001, License: LIC123456<br/>
            Doctor ID: DOC002, License: LIC789012<br/>
            Doctor ID: DOC003, License: LIC345678
          </div>
        </div>
      </div>
    </div>
  );
}

// Profile Modal
function ProfileModal() {
  const { user, role, setUser, setRole, profileOpen, setProfileOpen } = React.useContext(AppContext);
  if (!profileOpen) return null;
  function logout() {
    setProfileOpen(false);
    setTimeout(() => {
      if (user?.phone) {
        try { localStorage.removeItem("eSwasthyaUser_"+user.phone); } catch (e) {}
      }
      setUser(null);
      setRole(null);
      window.location.hash = "/";
    }, 300);
  }
  return (
  <div className="fixed inset-0 bg-black/30 flex items-center justify-center z-30 fade-in">
  <div className="bg-white rounded-xl shadow-lg p-8 w-80 relative slide-up">
        <button
          className="absolute top-2 right-2 text-blue-700 hover:text-red-500"
          onClick={() => setProfileOpen(false)}
        >
          <i className="fa-solid fa-xmark text-xl"></i>
        </button>
        <div className="flex flex-col items-center">
          <i className={`fa-solid ${role === "doctor" ? "fa-user-doctor" : "fa-user"} text-4xl text-teal-700 mb-2`}></i>
          <div className="font-bold text-lg text-blue-900 mb-1">{user?.name || (role === "doctor" ? "Doctor" : "Patient")}</div>
          <div className="text-blue-800 text-sm mb-2">{role === "doctor" ? "General Physician" : "Migrant Worker"}</div>
          <div className="w-full text-left text-blue-900 text-sm mt-2 mb-2">
            <div><b>Aadhar:</b> {user?.aadhar}</div>
            <div><b>Name:</b> {user?.name}</div>
            <div><b>Age:</b> {user?.age}</div>
            <div><b>Gender:</b> {user?.gender}</div>
            <div><b>Date of Birth:</b> {user?.dob}</div>
            <div><b>Blood Group:</b> {user?.blood}</div>
            <div><b>Height:</b> {user?.height} cm</div>
            <div><b>Weight:</b> {user?.weight} kg</div>
            <div><b>State:</b> {user?.state}</div>
            <div><b>City:</b> {user?.location}</div>
          </div>
          <button
            className="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded font-semibold transition mt-2"
            onClick={logout}
          >Logout</button>
        </div>
      </div>
    </div>
  );
}

// Infected Map Tab Component
function InfectedMapTab() {
  // State centroids for India (approximate)
  const STATE_CENTROIDS = {
    "Andhra Pradesh": [15.9129, 79.74],
    "Arunachal Pradesh": [28.218, 94.7278],
    "Assam": [26.2006, 92.9376],
    "Bihar": [25.0961, 85.3131],
    "Chhattisgarh": [21.2787, 81.8661],
    "Goa": [15.2993, 74.124],
    "Gujarat": [22.2587, 71.1924],
    "Haryana": [29.0588, 76.0856],
    "Himachal Pradesh": [31.1048, 77.1734],
    "Jharkhand": [23.6102, 85.2799],
    "Karnataka": [15.3173, 75.7139],
    "Kerala": [10.8505, 76.2711],
    "Madhya Pradesh": [22.9734, 78.6569],
    "Maharashtra": [19.7515, 75.7139],
    "Manipur": [24.6637, 93.9063],
    "Meghalaya": [25.467, 91.3662],
    "Mizoram": [23.1645, 92.9376],
    "Nagaland": [26.1584, 94.5624],
    "Odisha": [20.9517, 85.0985],
    "Punjab": [31.1471, 75.3412],
    "Rajasthan": [27.0238, 74.2179],
    "Sikkim": [27.533, 88.5122],
    "Tamil Nadu": [11.1271, 78.6569],
    "Telangana": [18.1124, 79.0193],
    "Tripura": [23.9408, 91.9882],
    "Uttar Pradesh": [26.8467, 80.9462],
    "Uttarakhand": [30.0668, 79.0193],
    "West Bengal": [22.9868, 87.855],
    "Delhi": [28.7041, 77.1025],
    "Jammu and Kashmir": [33.7782, 76.5762],
    "Ladakh": [34.1526, 77.5771],
    "Puducherry": [11.9416, 79.8083],
    "Chandigarh": [30.7333, 76.7794],
    "Andaman and Nicobar Islands": [11.7401, 92.6586],
    "Dadra and Nagar Haveli and Daman and Diu": [20.4283, 72.8397],
    "Lakshadweep": [10.5667, 72.6417],
  };
  // Helper to normalize state names (remove trailing * and spaces)
  function normalizeStateName(name) {
    return name.replace(/\*+$/g, '').trim();
  }
  const [stateData, setStateData] = React.useState([]);
  const [selectedState, setSelectedState] = React.useState("");
  const DISEASES = ["COVID-19", "Dengue", "Malaria", "Chikungunya", "Influenza"];
  const [selectedDisease, setSelectedDisease] = React.useState("COVID-19");
  // Multipliers approximate relative case volumes for demo purposes only
  const DISEASE_MULTIPLIER = {
    "COVID-19": 1,
    "Dengue": 0.15,
    "Malaria": 0.1,
    "Chikungunya": 0.05,
    "Influenza": 0.2,
  };
  React.useEffect(() => {
    // Fetch real state-level COVID data
    fetch("https://api.rootnet.in/covid19-in/stats/latest")
      .then(r => r.json())
      .then(data => {
        if (data && data.data && data.data.regional) {
          // Normalize state names in data
          const regional = data.data.regional.map(s => ({ ...s, loc: normalizeStateName(s.loc) }));
          setStateData(regional);
          setSelectedState(normalizeStateName(regional[0]?.loc || ""));
        }
      });
  }, []);
  React.useEffect(() => {
    if (!window.L) {
      const leaflet = document.createElement('link');
      leaflet.rel = 'stylesheet';
      leaflet.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';
      document.head.appendChild(leaflet);
      const script = document.createElement('script');
      script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
      script.onload = renderMap;
      document.body.appendChild(script);
    } else {
      renderMap();
    }
    function renderMap() {
      if (window._citymap) return;
      // India's bounding box: [SouthWest, NorthEast]
      const indiaBounds = [[6.5, 68.1], [37.1, 97.5]];
      window._citymap = window.L.map('city-infected-map', {
        maxBounds: indiaBounds,
        maxBoundsViscosity: 1.0,
        minZoom: 4,
        maxZoom: 8,
        zoomSnap: 0.25,
      }).fitBounds(indiaBounds);
      window.L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 8,
        attribution: '© OpenStreetMap'
      }).addTo(window._citymap);
    }
    return () => {
      if (window._citymap) { window._citymap.remove(); window._citymap = null; }
    };
  }, []);
  // Major cities for each state (with lat/lng, not exhaustive, for demo)
  const STATE_CITIES = {
    "Kerala": [
      { name: "Thiruvananthapuram", lat: 8.5241, lng: 76.9366 },
      { name: "Kochi", lat: 9.9312, lng: 76.2673 },
      { name: "Kozhikode", lat: 11.2588, lng: 75.7804 },
      { name: "Thrissur", lat: 10.5276, lng: 76.2144 },
      { name: "Kollam", lat: 8.8932, lng: 76.6141 }
    ],
    "Maharashtra": [
      { name: "Mumbai", lat: 19.0760, lng: 72.8777 },
      { name: "Pune", lat: 18.5204, lng: 73.8567 },
      { name: "Nagpur", lat: 21.1458, lng: 79.0882 },
      { name: "Nashik", lat: 19.9975, lng: 73.7898 },
      { name: "Aurangabad", lat: 19.8762, lng: 75.3433 }
    ],
    "Delhi": [
      { name: "New Delhi", lat: 28.6139, lng: 77.2090 },
      { name: "Dwarka", lat: 28.5921, lng: 77.0460 },
      { name: "Rohini", lat: 28.7499, lng: 77.0565 },
      { name: "Saket", lat: 28.5245, lng: 77.2066 }
    ],
    "Bihar": [
      { name: "Patna", lat: 25.5941, lng: 85.1376 },
      { name: "Gaya", lat: 24.7955, lng: 85.0002 },
      { name: "Bhagalpur", lat: 25.3476, lng: 86.9824 },
      { name: "Muzaffarpur", lat: 26.1226, lng: 85.3906 }
    ],
    "Karnataka": [
      { name: "Bengaluru", lat: 12.9716, lng: 77.5946 },
      { name: "Mysuru", lat: 12.2958, lng: 76.6394 },
      { name: "Mangaluru", lat: 12.9141, lng: 74.8560 },
      { name: "Hubballi", lat: 15.3647, lng: 75.1240 }
    ],
    "Tamil Nadu": [
      { name: "Chennai", lat: 13.0827, lng: 80.2707 },
      { name: "Coimbatore", lat: 11.0168, lng: 76.9558 },
      { name: "Madurai", lat: 9.9252, lng: 78.1198 },
      { name: "Tiruchirappalli", lat: 10.7905, lng: 78.7047 }
    ],
    "Uttar Pradesh": [
      { name: "Lucknow", lat: 26.8467, lng: 80.9462 },
      { name: "Kanpur", lat: 26.4499, lng: 80.3319 },
      { name: "Varanasi", lat: 25.3176, lng: 82.9739 },
      { name: "Agra", lat: 27.1767, lng: 78.0081 }
    ],
    // Add more states/cities as needed
  };
  React.useEffect(() => {
    if (window.L && window._citymap && stateData.length) {
      // Remove old circles
      if (window._citymap._circles) {
        window._citymap._circles.forEach(c => window._citymap.removeLayer(c));
      }
      if (!selectedState) return;
      // Always normalize selectedState for matching
      const normSelected = normalizeStateName(selectedState);
      const stateObj = stateData.find(s => normalizeStateName(s.loc) === normSelected);
      if (!stateObj) return;
      const centroid = STATE_CENTROIDS[normSelected];
      // If we have city data for this state, show cities
      const cities = STATE_CITIES[normSelected];
      const multiplier = DISEASE_MULTIPLIER[selectedDisease] || 1;
      if (cities && cities.length) {
        // Distribute total cases among cities (proportional, for demo)
        const totalCases = Math.max(0, Math.round(stateObj.totalConfirmed * multiplier));
        const base = Math.floor(totalCases / cities.length);
        const cityCases = cities.map((c, i) => i === 0 ? base + (totalCases % cities.length) : base);
        window._citymap._circles = cities.map((city, i) => {
          const cases = cityCases[i];
          let color = cases > 200000 ? '#b30000' : cases > 100000 ? '#e34a33' : cases > 50000 ? '#fc8d59' : '#fdbb84';
          let fill = color;
          const circle = window.L.circle([city.lat, city.lng], {
            color,
            fillColor: fill,
            fillOpacity: 0.7,
            radius: Math.max(12000, Math.sqrt(cases) * 18)
          }).addTo(window._citymap);
          circle.bindPopup(`<b>${city.name}</b><br/><b>${selectedDisease}</b> cases: ${cases.toLocaleString()}`);
          return circle;
        });
        // Fit map to cities (always for Kerala)
        const bounds = cities.map(c => [c.lat, c.lng]);
        if (bounds.length > 1) {
          window._citymap.fitBounds(bounds, { padding: [30, 30] });
        } else if (bounds.length === 1) {
          window._citymap.setView(bounds[0], 7);
        }
      } else if (centroid) {
        // Fallback: show state as a single circle
        const cases = Math.max(0, Math.round(stateObj.totalConfirmed * multiplier));
        let color = cases > 2000000 ? '#b30000' : cases > 1000000 ? '#e34a33' : cases > 500000 ? '#fc8d59' : '#fdbb84';
        let fill = color;
        const circle = window.L.circle(centroid, {
          color,
          fillColor: fill,
          fillOpacity: 0.6,
          radius: Math.max(20000, Math.sqrt(cases) * 8)
        }).addTo(window._citymap);
        circle.bindPopup(`<b>${normSelected}</b><br/><b>${selectedDisease}</b> cases: ${cases.toLocaleString()}`);
        window._citymap._circles = [circle];
        window._citymap.setView(centroid, 7);
      }
    }
  }, [stateData, selectedState, selectedDisease]);
  return (
    <div className="w-full flex flex-col items-center mb-8">
      <h3 className="text-xl font-bold text-blue-900 mb-2">Infected Cases by State (Live Data)</h3>
      <div className="mb-4 flex items-center gap-3 flex-wrap">
        <div className="flex items-center gap-2">
          <label className="font-semibold">Select State:</label>
          <select value={selectedState} onChange={e => setSelectedState(e.target.value)} className="border rounded px-3 py-2">
            {stateData.map(s => {
              const norm = normalizeStateName(s.loc);
              return <option key={norm} value={norm}>{norm}</option>;
            })}
          </select>
        </div>
        <div className="flex items-center gap-2">
          <label className="font-semibold">Disease:</label>
          <select value={selectedDisease} onChange={e => setSelectedDisease(e.target.value)} className="border rounded px-3 py-2">
            {DISEASES.map(d => (
              <option key={d} value={d}>{d}</option>
            ))}
          </select>
        </div>
      </div>
      <div id="city-infected-map" style={{ width: '100%', maxWidth: 800, height: 400, borderRadius: 16, boxShadow: '0 2px 12px #0001', margin: 'auto' }}></div>
      <div className="text-blue-800 text-sm mt-2">Showing <b>{selectedDisease}</b> distribution derived from latest state totals.</div>
      {selectedState && stateData.length > 0 && (() => {
        const normSelected = normalizeStateName(selectedState);
        const s = stateData.find(x => normalizeStateName(x.loc) === normSelected);
        if (!s) return null;
        return (
          <div className="mt-4 bg-white/80 rounded shadow p-4 max-w-lg w-full">
            <h4 className="font-semibold text-blue-900 mb-2">{normSelected} – {selectedDisease} Details</h4>
            <ul className="text-blue-900 text-sm">
              <li><b>Estimated Cases:</b> {Math.round(s.totalConfirmed * (DISEASE_MULTIPLIER[selectedDisease] || 1)).toLocaleString()}</li>
              <li><b>Reference (COVID totals):</b> {s.totalConfirmed.toLocaleString()} confirmed, {s.discharged.toLocaleString()} discharged, {s.deaths.toLocaleString()} deaths</li>
            </ul>
          </div>
        );
      })()}
    </div>
  );
}

// Doctor Dashboard
function DoctorDashboard() {
  const { user, setUser, setRole } = React.useContext(AppContext);
  const TABS = [
    { name: "Scan QR", icon: "fa-qrcode" },
    { name: "Patients Report", icon: "fa-file-medical" },
    { name: "Appointments", icon: "fa-calendar-check" },
    { name: "Prescriptions", icon: "fa-prescription-bottle-medical" },
    { name: "Health Trends", icon: "fa-chart-line" },
    { name: "Upload Reports", icon: "fa-upload" },
  { name: "Infected Cases", icon: "fa-map-location-dot" },
  ];
  const [tab, setTab] = React.useState(0);
  const [showProfile, setShowProfile] = React.useState(false);

  function logout() {
    setShowProfile(false);
    setTimeout(() => {
      if (user?.phone) {
        try { localStorage.removeItem("eSwasthyaUser_"+user.phone); } catch (e) {}
      }
      setUser(null);
      setRole(null);
      window.location.hash = "/";
    }, 300);
  }

  return (
    <div className="fixed inset-0 flex flex-col bg-gradient-to-br from-blue-50 via-teal-100 to-yellow-50 min-h-screen pulse-bg">
      <div className="w-full flex items-center bg-white/90 shadow px-8 py-4">
        {/* Profile Icon */}
        <button className="flex items-center gap-2 focus:outline-none" onClick={() => setShowProfile(v => !v)}>
          <i className="fa-solid fa-user-doctor text-3xl text-teal-700"></i>
          <span className="font-bold text-lg text-blue-900">Profile</span>
        </button>
        {/* ...other top bar content... */}
      </div>
      <div className="flex flex-1">
        {/* Profile Sidebar */}
        {showProfile && (
          <aside className="w-80 bg-white/95 shadow-lg h-full flex flex-col p-6 border-r border-blue-100 z-20 slide-up">
            <div className="flex flex-col items-center mb-6">
              <i className="fa-solid fa-user-doctor text-5xl text-teal-700 mb-2"></i>
              <div className="font-bold text-xl text-blue-900 mb-1">{user?.name || "Doctor"}</div>
              <div className="w-full text-left text-blue-900 text-sm mt-2 mb-2">
                <div><b>Aadhar:</b> {user?.aadhar}</div>
                <div><b>Name:</b> {user?.name}</div>
                <div><b>Age:</b> {user?.age}</div>
                <div><b>Gender:</b> {user?.gender}</div>
                <div><b>Date of Birth:</b> {user?.dob}</div>
                <div><b>Blood Group:</b> {user?.blood}</div>
                <div><b>Height:</b> {user?.height} cm</div>
                <div><b>Weight:</b> {user?.weight} kg</div>
                <div><b>State:</b> {user?.state}</div>
                <div><b>City:</b> {user?.location}</div>
              </div>
            </div>
            <div className="flex-1"></div>
            <button className="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded font-semibold transition" onClick={logout}>Logout</button>
          </aside>
        )}
        <nav className="w-56 border-r border-blue-100 py-8 flex flex-col gap-2 bg-white/80 rounded-r-3xl shadow-lg m-4">
          {TABS.map((t, i) => (
            <button
              key={t.name}
              className={`flex items-center gap-3 px-5 py-3 rounded-l-full text-blue-900 font-medium transition
                ${tab === i ? "bg-teal-100 shadow text-teal-800" : "hover:bg-blue-100"}
              `}
              onClick={() => setTab(i)}
            >
              <i className={`fa-solid ${t.icon} text-lg`}></i>
              {t.name}
            </button>
          ))}
        </nav>
        <section className="flex-1 p-8 fade-in slide-up overflow-y-auto">
          <div className="h-full max-h-[calc(100vh-160px)] overflow-y-auto pr-2">
            {tab === 0 && <ScanQRPlaceholder />}
            {tab === 1 && <PatientsReport />}
            {tab === 2 && <Appointments />}
            {tab === 3 && <DoctorPrescriptionsTab />}
            {tab === 4 && <HealthTrends />}
            {tab === 5 && <UploadReports />}
            {tab === 6 && <InfectedMapTab />}
          </div>
        </section>
      </div>
    </div>
  );
}

// Patient Dashboard
function PatientDashboard() {
  const { user, setUser, setRole } = React.useContext(AppContext);
  const TABS = [
    { name: "Health Record", icon: "fa-notes-medical" },
    { name: "My QR", icon: "fa-qrcode" },
    { name: "My Appointments", icon: "fa-calendar-check" },
    { name: "Pathlab", icon: "fa-vials" },
    { name: "Prescriptions", icon: "fa-prescription-bottle-medical" },
    { name: "Smart Health Analysis", icon: "fa-brain" },
    { name: "Emergency Services", icon: "fa-triangle-exclamation" },
    { name: "Infected Cases", icon: "fa-map-location-dot" },
  ];
  const [tab, setTab] = React.useState(0);
  const [showProfile, setShowProfile] = React.useState(false);

  function logout() {
    setShowProfile(false);
    setTimeout(() => {
      if (user?.phone) {
        try { localStorage.removeItem("eSwasthyaUser_"+user.phone); } catch (e) {}
      }
      setUser(null);
      setRole(null);
      window.location.hash = "/";
    }, 300);
  }

  return (
  <div className="fixed inset-0 flex flex-col bg-gradient-to-br from-blue-50 via-teal-100 to-yellow-50 min-h-screen pulse-bg">
      {/* Top Bar */}
      <div className="w-full flex items-center bg-white/90 shadow px-8 py-4">
        {/* Profile Icon */}
        <button className="flex items-center gap-2 focus:outline-none" onClick={() => setShowProfile(v => !v)}>
          <i className="fa-solid fa-user text-3xl text-teal-700"></i>
          <span className="font-bold text-lg text-blue-900">Profile</span>
        </button>
        {/* ...other top bar content... */}
      </div>
      <div className="flex flex-1">
        {/* Profile Sidebar */}
        {showProfile && (
          <aside className="w-80 bg-white/95 shadow-lg h-full flex flex-col p-6 border-r border-blue-100 z-20 slide-up">
            <div className="flex flex-col items-center mb-6">
              <i className="fa-solid fa-user text-5xl text-teal-700 mb-2"></i>
              <div className="font-bold text-xl text-blue-900 mb-1">{user?.name || "Patient"}</div>
              <div className="w-full text-left text-blue-900 text-sm mt-2 mb-2">
                <div><b>Aadhar:</b> {user?.aadhar}</div>
                <div><b>Name:</b> {user?.name}</div>
                <div><b>Age:</b> {user?.age}</div>
                <div><b>Gender:</b> {user?.gender}</div>
                <div><b>Date of Birth:</b> {user?.dob}</div>
                <div><b>Blood Group:</b> {user?.blood}</div>
                <div><b>Height:</b> {user?.height} cm</div>
                <div><b>Weight:</b> {user?.weight} kg</div>
                <div><b>State:</b> {user?.state}</div>
                <div><b>City:</b> {user?.location}</div>
              </div>
            </div>
            <div className="flex-1"></div>
            <button className="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded font-semibold transition" onClick={logout}>Logout</button>
          </aside>
        )}
        <nav className="w-56 border-r border-blue-100 py-8 flex flex-col gap-2 bg-white/80 rounded-r-3xl shadow-lg m-4">
          {TABS.map((t, i) => (
            <button
              key={t.name}
              className={`flex items-center gap-3 px-5 py-3 rounded-l-full text-blue-900 font-medium transition
                ${tab === i ? "bg-teal-100 shadow text-teal-800" : "hover:bg-blue-100"}
              `}
              onClick={() => setTab(i)}
            >
              <i className={`fa-solid ${t.icon} text-lg`}></i>
              {t.name}
            </button>
          ))}
        </nav>
        <section className="flex-1 p-8 fade-in slide-up overflow-y-auto">
          <div className="h-full max-h-[calc(100vh-160px)] overflow-y-auto pr-2">
            {tab === 0 && <HealthRecord />}
            {tab === 1 && <MyQR />}
            {tab === 2 && <PatientAppointments />}
            {tab === 3 && <PathlabTab />}
            {tab === 4 && <PrescriptionsTab />}
            {tab === 5 && <SmartHealthAnalysis />}
            {tab === 6 && <EmergencyPlaceholder />}
            {tab === 7 && <InfectedMapTab />}
          </div>
        </section>
      </div>
    </div>
  );
}

// --- Dashboard Tab Placeholders ---

function ScanQRPlaceholder() {
  return (
  <div className="flex flex-col items-center justify-center h-full slide-up">
      <i className="fa-solid fa-qrcode text-6xl text-teal-600 mb-4"></i>
      <div className="text-xl font-bold text-blue-900 mb-2">Scan QR</div>
      <div className="text-blue-800 mb-4">QR code scanning feature coming soon.</div>
      <button className="bg-teal-600 text-white px-4 py-2 rounded hover:bg-teal-700 transition">
        <i className="fa-solid fa-camera mr-2"></i>Open Scanner
      </button>
    </div>
  );
}

function PatientsReport() {
  return (
  <div className="slide-up">
      <div className="text-xl font-bold text-blue-900 mb-4">Patients Report</div>
      <table className="w-full bg-white rounded shadow text-blue-900 mb-6">
        <thead>
          <tr className="bg-blue-50">
            <th className="py-2 px-3 text-left">Name</th>
            <th className="py-2 px-3 text-left">Age</th>
            <th className="py-2 px-3 text-left">Last Visit</th>
            <th className="py-2 px-3 text-left">Recent Diagnosis</th>
          </tr>
        </thead>
        <tbody>
          {DUMMY_PATIENTS.map(p => (
            <tr key={p.id} className="hover:bg-blue-100 transition">
              <td className="py-2 px-3">{p.name}</td>
              <td className="py-2 px-3">{p.age}</td>
              <td className="py-2 px-3">{p.lastVisit}</td>
              <td className="py-2 px-3">{p.id === 1 ? 'Mild Anemia' : 'Normal'}</td>
            </tr>
          ))}
        </tbody>
      </table>
      <div className="text-blue-800 text-sm">Click on a patient to view full medical history and reports.</div>
    </div>
  );
}

function Appointments() {
  const [patientRequests, setPatientRequests] = React.useState(DUMMY_PATIENT_REQUESTS);
  const [appointments, setAppointments] = React.useState(DUMMY_APPOINTMENTS);

  function handleApproveRequest(requestId) {
    setPatientRequests(prev => 
      prev.map(req => 
        req.id === requestId 
          ? { ...req, status: "Approved" }
          : req
      )
    );
    // Move approved request to appointments
    const approvedRequest = patientRequests.find(req => req.id === requestId);
    if (approvedRequest) {
      const newAppointment = {
        id: appointments.length + 1,
        with: approvedRequest.patientName,
        date: approvedRequest.date,
        status: "Upcoming",
        time: approvedRequest.time,
        reason: approvedRequest.reason
      };
      setAppointments(prev => [...prev, newAppointment]);
    }
  }

  function handleDeclineRequest(requestId) {
    setPatientRequests(prev => 
      prev.map(req => 
        req.id === requestId 
          ? { ...req, status: "Declined" }
          : req
      )
    );
  }

  const pendingRequests = patientRequests.filter(req => req.status === "Pending");
  const approvedRequests = patientRequests.filter(req => req.status === "Approved");
  const declinedRequests = patientRequests.filter(req => req.status === "Declined");

  return (
    <div className="slide-up">
      <div className="text-xl font-bold text-blue-900 mb-6">Appointment Management</div>
      
      {/* Patient Requests Section */}
      <div className="mb-8">
        <h3 className="text-lg font-semibold text-blue-900 mb-4 flex items-center gap-2">
          <i className="fa-solid fa-user-clock text-teal-600"></i>
          Patient Appointment Requests ({pendingRequests.length})
        </h3>
        
        {pendingRequests.length > 0 ? (
          <ul className="space-y-4">
            {pendingRequests.map(request => (
              <li key={request.id} className="bg-yellow-50 border-l-4 border-yellow-400 rounded p-4 shadow">
                <div className="flex justify-between items-start">
                  <div className="flex-1">
                    <div className="flex items-center gap-3 mb-2">
                      <i className="fa-solid fa-user text-blue-600"></i>
                      <div className="font-semibold text-blue-900">{request.patientName}</div>
                      <div className="text-blue-700 text-sm">Age: {request.patientAge}</div>
                    </div>
                    <div className="text-blue-800 text-sm mb-1">
                      <i className="fa-solid fa-calendar mr-1"></i>
                      {request.date} at {request.time}
                    </div>
                    <div className="text-blue-700 text-sm">
                      <i className="fa-solid fa-stethoscope mr-1"></i>
                      Reason: {request.reason}
                    </div>
                  </div>
                  <div className="flex gap-2 ml-4">
                    <button
                      onClick={() => handleApproveRequest(request.id)}
                      className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition flex items-center gap-1"
                    >
                      <i className="fa-solid fa-check"></i>
                      Approve
                    </button>
                    <button
                      onClick={() => handleDeclineRequest(request.id)}
                      className="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition flex items-center gap-1"
                    >
                      <i className="fa-solid fa-times"></i>
                      Decline
                    </button>
                  </div>
                </div>
              </li>
            ))}
          </ul>
        ) : (
          <div className="bg-blue-50 rounded-lg p-6 text-center">
            <i className="fa-solid fa-check-circle text-green-500 text-3xl mb-2"></i>
            <div className="text-blue-800">No pending appointment requests</div>
          </div>
        )}
      </div>

      {/* Approved Appointments */}
      <div className="mb-6">
        <h3 className="text-lg font-semibold text-blue-900 mb-4 flex items-center gap-2">
          <i className="fa-solid fa-calendar-check text-green-600"></i>
          Confirmed Appointments
        </h3>
        <ul className="space-y-3">
          {appointments.map(a => (
            <li key={a.id} className="bg-green-50 border-l-4 border-green-400 rounded p-4 shadow">
              <div className="flex items-center gap-3">
                <i className="fa-solid fa-calendar-check text-green-600 text-xl"></i>
                <div className="flex-1">
                  <div className="font-semibold text-blue-900">{a.with}</div>
                  <div className="text-blue-800 text-sm">{a.date} {a.time && `at ${a.time}`} &middot; {a.status}</div>
                  {a.reason && <div className="text-blue-700 text-xs mt-1">Reason: {a.reason}</div>}
                </div>
                <div className="text-green-600 text-sm font-medium">
                  <i className="fa-solid fa-check-circle mr-1"></i>
                  Confirmed
                </div>
              </div>
            </li>
          ))}
        </ul>
      </div>

      {/* Declined Requests */}
      {declinedRequests.length > 0 && (
        <div className="mb-6">
          <h3 className="text-lg font-semibold text-blue-900 mb-4 flex items-center gap-2">
            <i className="fa-solid fa-calendar-xmark text-red-600"></i>
            Declined Requests ({declinedRequests.length})
          </h3>
          <ul className="space-y-3">
            {declinedRequests.map(request => (
              <li key={request.id} className="bg-red-50 border-l-4 border-red-400 rounded p-4 shadow">
                <div className="flex items-center gap-3">
                  <i className="fa-solid fa-user-times text-red-600 text-xl"></i>
                  <div className="flex-1">
                    <div className="font-semibold text-blue-900">{request.patientName}</div>
                    <div className="text-blue-800 text-sm">{request.date} at {request.time}</div>
                    <div className="text-blue-700 text-xs mt-1">Reason: {request.reason}</div>
                  </div>
                  <div className="text-red-600 text-sm font-medium">
                    <i className="fa-solid fa-times-circle mr-1"></i>
                    Declined
                  </div>
                </div>
              </li>
            ))}
          </ul>
        </div>
      )}

      <div className="mt-6 p-4 bg-blue-50 rounded-lg">
        <div className="text-blue-800 text-sm">
          <i className="fa-solid fa-info-circle mr-2"></i>
          <strong>Note:</strong> Approved appointments will be automatically scheduled. Patients will receive confirmation notifications.
        </div>
      </div>
    </div>
  );
}

function HealthTrends() {
  // Chart placeholder
  return (
  <div className="slide-up">
      <div className="text-xl font-bold text-blue-900 mb-4">Health Trends</div>
      <div className="bg-blue-50 rounded-lg p-8 flex flex-col items-center justify-center">
        <i className="fa-solid fa-chart-line text-4xl text-teal-600 mb-3"></i>
        <div className="text-blue-800 mb-2">Recent health trends and statistics for your patients:</div>
        <div className="w-full h-40 bg-gradient-to-r from-teal-200 to-blue-200 rounded mb-4"></div>
        <ul className="w-full max-w-lg mx-auto text-blue-900 text-sm">
          <li className="mb-1">• <b>Avg. Blood Pressure:</b> 122/82 mmHg (last 30 days)</li>
          <li className="mb-1">• <b>Most Common Diagnosis:</b> Mild Anemia (22%)</li>
          <li className="mb-1">• <b>Avg. Age of Patients:</b> 31 years</li>
          <li className="mb-1">• <b>Recent Alerts:</b> 2 patients with high fever in last week</li>
          <li className="mb-1">• <b>Follow-up Rate:</b> 68% patients returned for follow-up</li>
        </ul>
      </div>
    </div>
  );
}

function UploadReports() {
  return (
  <div className="slide-up">
      <div className="text-xl font-bold text-blue-900 mb-4">Upload Reports</div>
      <div className="bg-blue-50 rounded-lg p-8 flex flex-col items-center">
        <i className="fa-solid fa-upload text-4xl text-teal-600 mb-3"></i>
        <div className="text-blue-800 mb-2">Upload patient reports here. Accepted formats: PDF, JPG, PNG.</div>
        <input type="file" className="mb-4" />
        <button className="bg-teal-600 text-white px-4 py-2 rounded hover:bg-teal-700 transition">
          Upload
        </button>
        <div className="text-xs text-blue-700 mt-2">Max file size: 5MB</div>
      </div>
      <div className="mt-6">
        <div className="font-semibold mb-2">Recent Reports</div>
        <ul>
          {DUMMY_REPORTS.map(r => (
            <li key={r.id} className="bg-white rounded p-3 mb-2 shadow flex items-center gap-3">
              <i className="fa-solid fa-file-medical text-blue-700"></i>
              <span>{r.patient} - {r.type} ({r.date})</span>
              <span className="ml-auto text-xs text-blue-800">Status: {r.id === 1 ? 'Verified' : 'Pending'}</span>
            </li>
          ))}
        </ul>
      </div>
    </div>
  );
}

function EmergencyPlaceholder() {
  return (
  <div className="flex flex-col items-center justify-center h-full slide-up">
      <i className="fa-solid fa-triangle-exclamation text-6xl text-red-500 mb-4"></i>
      <div className="text-xl font-bold text-blue-900 mb-2">Emergency</div>
      <div className="text-blue-800 mb-4">Emergency services and alerts coming soon.</div>
      <button className="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition">
        <i className="fa-solid fa-phone mr-2"></i>Call Emergency
      </button>
    </div>
  );
}

// Patient Dashboard Tabs
function HealthRecord() {
  return (
  <div className="slide-up">
      <div className="text-xl font-bold text-blue-900 mb-4">Health Record</div>
      <div className="bg-blue-50 rounded-lg p-8 flex flex-col items-center w-full max-w-2xl mx-auto">
        <i className="fa-solid fa-notes-medical text-4xl text-teal-600 mb-3"></i>
        <div className="text-blue-800 mb-2">Your health records will appear here.</div>
        <ul className="w-full text-left">
          <li className="mb-2"><b>Blood Test</b> <span className="text-xs text-blue-700">(2025-09-01)</span><br/>Hemoglobin: 13.5 g/dL, WBC: 6,000 /mm³, Platelets: 2,50,000 /mm³</li>
          <li className="mb-2"><b>X-Ray</b> <span className="text-xs text-blue-700">(2025-08-21)</span><br/>Chest: Normal, No abnormal findings</li>
          <li className="mb-2"><b>Blood Pressure</b> <span className="text-xs text-blue-700">(2025-08-10)</span><br/>120/80 mmHg</li>
        </ul>
      </div>
    </div>
  );
}

function MyQR() {
  const { user } = React.useContext(AppContext);
  return (
  <div className="flex flex-col items-center justify-center h-full slide-up">
      <i className="fa-solid fa-qrcode text-6xl text-teal-600 mb-4"></i>
      <div className="text-xl font-bold text-blue-900 mb-2">My QR</div>
      <div className="text-blue-800 mb-4">Show this QR code to your doctor for quick access to your health profile.</div>
      <div className="bg-white p-6 rounded shadow mb-4">
        <img src={`https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=${encodeURIComponent(user?.aadhar || 'Unknown')}`} alt="QR" />
      </div>
      <div className="text-blue-900 text-sm">Name: <b>{user?.name || 'Rahul Kumar'}</b></div>
      <div className="text-blue-900 text-sm">Aadhar: <b>{user?.aadhar}</b></div>
      <div className="text-blue-900 text-sm">State: <b>{user?.state}</b></div>
      <div className="text-blue-900 text-sm">City: <b>{user?.location}</b></div>
    </div>
  );
}

function SmartHealthAnalysis() {
  const [input, setInput] = React.useState("");
  const [result, setResult] = React.useState(null);
  function analyze() {
    // Simple mock logic for demo
    if (/fever|temperature|hot/i.test(input)) setResult("Possible fever detected. Stay hydrated and rest.");
    else if (/cough|cold|sneeze/i.test(input)) setResult("Symptoms suggest a mild cold. Monitor and consult if worsens.");
    else if (/pain|ache/i.test(input)) setResult("Pain detected. If severe or persistent, seek medical advice.");
    else if (input.length > 10) setResult("No critical issues detected. For detailed analysis, consult a doctor.");
    else setResult("Please enter your symptoms or health query.");
  }
  return (
  <div className="slide-up">
      <div className="text-xl font-bold text-blue-900 mb-4">Smart Health Analysis</div>
      <div className="bg-blue-50 rounded-lg p-8 flex flex-col items-center w-full max-w-xl mx-auto">
        <i className="fa-solid fa-brain text-4xl text-teal-600 mb-3"></i>
        <div className="text-blue-800 mb-2">Describe your symptoms or health query below for instant AI-powered suggestions.</div>
        <textarea
          className="w-full border border-blue-200 rounded px-3 py-2 mb-3 focus:outline-none focus:ring-2 focus:ring-teal-300"
          rows={3}
          placeholder="e.g. I have a headache and mild fever"
          value={input}
          onChange={e => setInput(e.target.value)}
        />
        <button
          className="bg-teal-600 text-white px-4 py-2 rounded hover:bg-teal-700 transition mb-3"
          onClick={analyze}
        >Analyze</button>
        {result && (
          <div className="w-full bg-white rounded p-4 shadow text-blue-900 text-base">
            <b>AI Suggestion:</b> {result}
          </div>
        )}
      </div>
    </div>
  );
}

function PatientAppointments() {
  const appointments = DUMMY_PATIENT_APPOINTMENTS;
  return (
    <div className="slide-up">
      <div className="text-xl font-bold text-blue-900 mb-6">My Appointments</div>
      <div className="space-y-3">
        {appointments.map(a => (
          <div key={a.id} className={`rounded p-4 shadow bg-white border-l-4 ${a.status === 'Upcoming' ? 'border-blue-400' : a.status === 'Completed' ? 'border-green-400' : 'border-red-400'}`}>
            <div className="flex items-center justify-between">
              <div className="text-blue-900 font-semibold">
                <i className="fa-solid fa-user-doctor text-teal-700 mr-2"></i>
                {a.doctor}
              </div>
              <div className="text-sm text-blue-700">{a.date} at {a.time}</div>
            </div>
            <div className="mt-1 text-blue-800 text-sm">Reason: {a.reason}</div>
            <div className={`mt-2 inline-block text-xs font-medium px-2 py-1 rounded ${a.status === 'Upcoming' ? 'bg-blue-100 text-blue-800' : a.status === 'Completed' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
              {a.status}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

function PathlabTab() {
  const { user } = React.useContext(AppContext);
  // Filter reports for current user if name present; otherwise show all demo
  const reports = DUMMY_REPORTS.filter(r => !user?.name || r.patient === user.name);
  const hasReports = reports.length > 0;
  return (
    <div className="slide-up">
      <div className="text-xl font-bold text-blue-900 mb-4">Pathlab Reports</div>
      {hasReports ? (
        <div className="bg-white rounded shadow overflow-hidden">
          <table className="w-full text-blue-900">
            <thead className="bg-blue-50">
              <tr>
                <th className="py-2 px-3 text-left">Patient</th>
                <th className="py-2 px-3 text-left">Test Type</th>
                <th className="py-2 px-3 text-left">Date</th>
                <th className="py-2 px-3 text-left">Status</th>
                <th className="py-2 px-3 text-left">Action</th>
              </tr>
            </thead>
            <tbody>
              {reports.map(r => (
                <tr key={r.id} className="hover:bg-blue-100 transition">
                  <td className="py-2 px-3">{r.patient}</td>
                  <td className="py-2 px-3">{r.type}</td>
                  <td className="py-2 px-3">{r.date}</td>
                  <td className="py-2 px-3">{r.id === 1 ? 'Verified' : 'Pending'}</td>
                  <td className="py-2 px-3">
                    <button className="text-teal-700 hover:underline">
                      <i className="fa-solid fa-eye mr-1"></i>
                      View
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      ) : (
        <div className="bg-blue-50 rounded-lg p-6 text-center">
          <i className="fa-solid fa-vial-circle-check text-teal-600 text-3xl mb-2"></i>
          <div className="text-blue-800">No pathology reports found for your profile yet.</div>
        </div>
      )}
    </div>
  );
}

function PrescriptionsTab() {
  const { user } = React.useContext(AppContext);
  const prescriptions = DUMMY_PRESCRIPTIONS.filter(p => !user?.name || p.patient === user.name);
  const hasRx = prescriptions.length > 0;
  return (
    <div className="slide-up">
      <div className="text-xl font-bold text-blue-900 mb-4">Prescriptions</div>
      {hasRx ? (
        <div className="space-y-4">
          {prescriptions.map(rx => (
            <div key={rx.id} className="bg-white rounded shadow p-4">
              <div className="flex items-center justify-between mb-2">
                <div className="font-semibold text-blue-900">
                  <i className="fa-solid fa-prescription-bottle-medical text-teal-700 mr-2"></i>
                  {rx.doctor}
                </div>
                <div className="text-blue-700 text-sm">{rx.date}</div>
              </div>
              <div className="text-blue-800 text-sm mb-2">Patient: {rx.patient}</div>
              <table className="w-full text-blue-900 mb-2">
                <thead className="bg-blue-50">
                  <tr>
                    <th className="py-2 px-3 text-left">Medicine</th>
                    <th className="py-2 px-3 text-left">Dosage</th>
                    <th className="py-2 px-3 text-left">Frequency</th>
                    <th className="py-2 px-3 text-left">Days</th>
                  </tr>
                </thead>
                <tbody>
                  {rx.medicines.map((m, i) => (
                    <tr key={i} className="hover:bg-blue-100 transition">
                      <td className="py-2 px-3">{m.name}</td>
                      <td className="py-2 px-3">{m.dosage}</td>
                      <td className="py-2 px-3">{m.freq}</td>
                      <td className="py-2 px-3">{m.days}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
              {rx.notes && (
                <div className="text-blue-800 text-sm"><b>Notes:</b> {rx.notes}</div>
              )}
            </div>
          ))}
        </div>
      ) : (
        <div className="bg-blue-50 rounded-lg p-6 text-center">
          <i className="fa-solid fa-file-prescription text-teal-600 text-3xl mb-2"></i>
          <div className="text-blue-800">No prescriptions found for your profile yet.</div>
        </div>
      )}
    </div>
  );
}

function DoctorPrescriptionsTab() {
  const { user } = React.useContext(AppContext);
  const doctorName = user?.name || "Doctor";
  const prescriptions = DUMMY_PRESCRIPTIONS.filter(p => p.doctor === doctorName);
  const hasRx = prescriptions.length > 0;
  return (
    <div className="slide-up">
      <div className="text-xl font-bold text-blue-900 mb-4">My Prescriptions</div>
      {hasRx ? (
        <div className="space-y-4">
          {prescriptions.map(rx => (
            <div key={rx.id} className="bg-white rounded shadow p-4">
              <div className="flex items-center justify-between mb-2">
                <div className="font-semibold text-blue-900">
                  <i className="fa-solid fa-user text-teal-700 mr-2"></i>
                  {rx.patient}
                </div>
                <div className="text-blue-700 text-sm">{rx.date}</div>
              </div>
              <table className="w-full text-blue-900 mb-2">
                <thead className="bg-blue-50">
                  <tr>
                    <th className="py-2 px-3 text-left">Medicine</th>
                    <th className="py-2 px-3 text-left">Dosage</th>
                    <th className="py-2 px-3 text-left">Frequency</th>
                    <th className="py-2 px-3 text-left">Days</th>
                  </tr>
                </thead>
                <tbody>
                  {rx.medicines.map((m, i) => (
                    <tr key={i} className="hover:bg-blue-100 transition">
                      <td className="py-2 px-3">{m.name}</td>
                      <td className="py-2 px-3">{m.dosage}</td>
                      <td className="py-2 px-3">{m.freq}</td>
                      <td className="py-2 px-3">{m.days}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
              {rx.notes && (
                <div className="text-blue-800 text-sm"><b>Notes:</b> {rx.notes}</div>
              )}
            </div>
          ))}
        </div>
      ) : (
        <div className="bg-blue-50 rounded-lg p-6 text-center">
          <i className="fa-solid fa-prescription-bottle-medical text-teal-600 text-3xl mb-2"></i>
          <div className="text-blue-800">You haven't issued any prescriptions yet.</div>
        </div>
      )}
    </div>
  );
}

// --- Render App ---
ReactDOM.createRoot(document.getElementById('root')).render(
  <AppProvider>
    <App />
  </AppProvider>
);

  </script>
</body>
</html>